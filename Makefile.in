harvest : harvest.o libharvest.a
	gcc -arch x86_64 -o harvest -lstdc++ libharvest.a harvest.o

libharvest.a : HarvestIO.o pb/harvest.pb.o
	libtool -static -o libharvest.a @protolib@ @zlib@ HarvestIO.o pb/harvest.pb.o

harvest.o : harvest.cpp HarvestIO.h pb/harvest.pb.h
	gcc -arch x86_64 -c harvest.cpp

HarvestIO.o : HarvestIO.cpp HarvestIO.h pb/harvest.pb.cc pb/harvest.pb.h
	gcc -arch x86_64 -c -Ipb HarvestIO.cpp

pb/harvest.pb.o : pb/harvest.pb.cc
	@cd pb; gcc -arch x86_64 -c harvest.pb.cc

pb/harvest.pb.cc pb/harvest.pb.h : pb/harvest.proto
	@cd pb; @protoc@ --cpp_out . harvest.proto

install : libharvest.a
	mkdir -p @prefix@/lib/
	mkdir -p @prefix@/include/
	ln -sf `pwd`/libharvest.a @prefix@/lib/
	ln -sf `pwd`/HarvestIO.h @prefix@/include/
	ln -sf `pwd`/pb/harvest.pb.h @prefix@/include/
